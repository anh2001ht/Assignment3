@page
@model Assignment3.Pages.Reports.IndexModel
@{
    ViewData["Title"] = "Reports & Analytics";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="mb-1">
                        <i class="fas fa-chart-bar text-primary"></i> Reports & Analytics
                    </h2>
                    <p class="text-muted">Comprehensive insights and analytics for event management</p>
                </div>
                <div class="btn-group" role="group">
                    <button type="button" class="btn btn-outline-primary" onclick="window.location.reload()">
                        <i class="fas fa-sync-alt"></i> Refresh
                    </button>
                    <button type="button" class="btn btn-outline-success" onclick="exportToCSV()">
                        <i class="fas fa-download"></i> Export CSV
                    </button>
                    <button type="button" class="btn btn-outline-info" onclick="window.print()">
                        <i class="fas fa-print"></i> Print Report
                    </button>
                </div>
            </div>

            @if (TempData["SuccessMessage"] != null)
            {
                <div class="alert alert-success alert-dismissible fade show" role="alert">
                    <i class="fas fa-check-circle"></i> @TempData["SuccessMessage"]
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            }

            <!-- Quick Statistics Overview -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body text-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-1">@Model.TotalEvents</h3>
                                    <p class="mb-0">Total Events</p>
                                    <small><i class="fas fa-arrow-up"></i> @Model.UpcomingEvents upcoming</small>
                                </div>
                                <i class="fas fa-calendar-alt fa-3x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body text-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-1">@Model.TotalUsers</h3>
                                    <p class="mb-0">Total Users</p>
                                    <small><i class="fas fa-user-plus"></i> @Model.AdminUsers admins</small>
                                </div>
                                <i class="fas fa-users fa-3x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body text-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-1">@Model.TotalRegistrations</h3>
                                    <p class="mb-0">Total Registrations</p>
                                    <small><i class="fas fa-chart-line"></i> @Model.RegistrationsThisMonth this month</small>
                                </div>
                                <i class="fas fa-ticket-alt fa-3x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-warning text-white">
                        <div class="card-body text-center">
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    <h3 class="mb-1">@Model.ActiveEvents</h3>
                                    <p class="mb-0">Active Events</p>
                                    <small><i class="fas fa-clock"></i> @Model.PastEvents completed</small>
                                </div>
                                <i class="fas fa-play-circle fa-3x opacity-75"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Report Filters -->
            <div class="card mb-4">
                <div class="card-header bg-light">
                    <h5 class="mb-0">
                        <i class="fas fa-filter"></i> Report Filters
                    </h5>
                </div>
                <div class="card-body">
                    <form method="get" class="row g-3">
                        <div class="col-md-4">
                            <label asp-for="DateFrom" class="form-label">From Date</label>
                            <input asp-for="DateFrom" type="date" class="form-control" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="DateTo" class="form-label">To Date</label>
                            <input asp-for="DateTo" type="date" class="form-control" />
                        </div>
                        <div class="col-md-4">
                            <label asp-for="ReportType" class="form-label">Report Type</label>
                            <select asp-for="ReportType" class="form-select">
                                <option value="">All Reports</option>
                                <option value="events">Events Only</option>
                                <option value="users">Users Only</option>
                                <option value="registrations">Registrations Only</option>
                            </select>
                        </div>
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-search"></i> Apply Filters
                            </button>
                            <a href="@Url.Page("/Reports/Index")" class="btn btn-outline-secondary">
                                <i class="fas fa-times"></i> Clear Filters
                            </a>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Detailed Reports Grid -->
            <div class="row">
                <!-- Events Summary -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-calendar-alt"></i> Events Summary
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td><strong>Total Events:</strong></td>
                                            <td>@Model.TotalEvents</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Upcoming Events:</strong></td>
                                            <td>@Model.UpcomingEvents</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Past Events:</strong></td>
                                            <td>@Model.PastEvents</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Average Attendees:</strong></td>
                                            <td>@Model.AverageRegistrationsPerEvent</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Most Popular Category:</strong></td>
                                            <td>@Model.MostPopularCategory</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- User Statistics -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-success text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-users"></i> User Statistics
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td><strong>Total Users:</strong></td>
                                            <td>@Model.TotalUsers</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Active Users:</strong></td>
                                            <td>@Model.ActiveUsers</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Admin Users:</strong></td>
                                            <td>@Model.AdminUsers</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Event Managers:</strong></td>
                                            <td>@Model.EventManagers</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Regular Users:</strong></td>
                                            <td>@(Model.TotalUsers - Model.AdminUsers - Model.EventManagers)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Registration Trends -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-info text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-chart-line"></i> Registration Trends
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td><strong>Total Registrations:</strong></td>
                                            <td>@Model.TotalRegistrations</td>
                                        </tr>
                                        <tr>
                                            <td><strong>This Month:</strong></td>
                                            <td>@Model.RegistrationsThisMonth</td>
                                        </tr>
                                        <tr>
                                            <td><strong>This Week:</strong></td>
                                            <td>@Model.RegistrationsThisWeek</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Daily Average:</strong></td>
                                            <td>@Math.Round((decimal)Model.RegistrationsThisMonth / DateTime.DaysInMonth(DateTime.Now.Year, DateTime.Now.Month), 1)</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Weekly Average:</strong></td>
                                            <td>@Math.Round((decimal)Model.RegistrationsThisMonth / 4, 1)</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- System Health -->
                <div class="col-md-6 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-warning text-white">
                            <h5 class="mb-0">
                                <i class="fas fa-heartbeat"></i> System Health
                            </h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <tbody>
                                        <tr>
                                            <td><strong>System Status:</strong></td>
                                            <td><span class="badge bg-success">Healthy</span></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Database Status:</strong></td>
                                            <td><span class="badge bg-success">Connected</span></td>
                                        </tr>
                                        <tr>
                                            <td><strong>Active Sessions:</strong></td>
                                            <td>@Model.ActiveUsers</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Last Update:</strong></td>
                                            <td>@DateTime.Now.ToString("MMM dd, yyyy HH:mm")</td>
                                        </tr>
                                        <tr>
                                            <td><strong>Data Integrity:</strong></td>
                                            <td><span class="badge bg-success">Valid</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Reports Section -->
            @if (!string.IsNullOrEmpty(Model.ReportType))
            {
                <div class="card mt-4">
                    <div class="card-header bg-dark text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-list-alt"></i> Detailed @Model.ReportType.ToTitleCase() Report
                        </h5>
                    </div>
                    <div class="card-body">
                        @if (Model.ReportType == "events")
                        {
                            <p>Detailed events data would be displayed here based on date filters.</p>
                        }
                        else if (Model.ReportType == "users")
                        {
                            <p>Detailed user activity data would be displayed here based on date filters.</p>
                        }
                        else if (Model.ReportType == "registrations")
                        {
                            <p>Detailed registration data would be displayed here based on date filters.</p>
                        }
                        
                        <div class="text-center mt-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading detailed data...</span>
                            </div>
                            <p class="text-muted mt-2">Generating detailed report...</p>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function exportToCSV() {
            // Simple CSV export functionality
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "Report Type,Value\n";
            csvContent += "Total Events,@Model.TotalEvents\n";
            csvContent += "Total Users,@Model.TotalUsers\n";
            csvContent += "Total Registrations,@Model.TotalRegistrations\n";
            csvContent += "Active Events,@Model.ActiveEvents\n";
            csvContent += "Upcoming Events,@Model.UpcomingEvents\n";
            csvContent += "Past Events,@Model.PastEvents\n";
            csvContent += "Registrations This Month,@Model.RegistrationsThisMonth\n";
            csvContent += "Registrations This Week,@Model.RegistrationsThisWeek\n";
            csvContent += "Most Popular Category,@Model.MostPopularCategory\n";
            
            var encodedUri = encodeURI(csvContent);
            var link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "event_management_report_" + new Date().toISOString().split('T')[0] + ".csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            toastr.success('Report exported successfully!');
        }

        // Auto-refresh every 5 minutes
        setTimeout(function() {
            if (confirm('Refresh report data?')) {
                window.location.reload();
            }
        }, 300000);
    </script>
} 